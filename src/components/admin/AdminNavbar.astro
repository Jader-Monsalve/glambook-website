---
export interface Props {
  currentUser?: string;
}

const { currentUser } = Astro.props;
---
<script>
// Mostrar/ocultar menú hamburguesa en móvil correctamente
document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    if (btn && menu) {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            menu.classList.toggle('open');
            if (menu.classList.contains('open')) {
                menu.classList.remove('hidden');
            } else {
                menu.classList.add('hidden');
            }
        });
        // Cerrar menú al hacer click fuera
            document.addEventListener('click', function(e) {
                const target = e.target as Node;
                if (!menu.contains(target) && !btn.contains(target)) {
                    menu.classList.remove('open');
                    menu.classList.add('hidden');
                }
            });
        // Cerrar menú al hacer click en un enlace
        menu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function() {
                menu.classList.remove('open');
                menu.classList.add('hidden');
            });
        });
    }
});
</script>

<nav class="admin-navbar bg-white/90 backdrop-blur-md border-b border-gray-200 shadow-sm sticky top-0 z-50">
    <div class="navbar-container max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 xl:px-8">
        <div class="flex justify-between items-center h-12 sm:h-14 lg:h-16">
            <!-- Header principal: logo, botón y hamburguesa -->
            <div class="flex items-center gap-2 flex-1 min-w-0">
                <div class="flex items-center navbar-logo flex-shrink-0">
                    <div class="logo-icon w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-md">
                        <span class="text-white text-xl font-bold bg-gradient-to-br from-pink-500 to-purple-600 w-full h-full flex items-center justify-center rounded-lg">G</span>
                    </div>
                    <span class="text-lg font-bold text-gray-800 font-poppins ml-2 truncate">GlamBook</span>
                </div>
            </div>
            <button 
              id="mobile-menu-btn"
              class="flex lg:hidden p-2 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 touch-manipulation min-w-[44px] min-h-[44px] items-center justify-center bg-white border border-gray-200 shadow-sm ml-2"
              aria-label="Abrir menú de navegación"
              aria-expanded="false"
              type="button"
            >
              <span class="sr-only">Abrir menú de navegación</span>
              <span id="mobile-menu-icon" class="text-xl block transition-transform duration-300 font-bold">☰</span>
            </button>
            <!-- Listado de enlaces para navegar en menú móvil (solo visible cuando el menú está abierto) -->
            <div id="mobile-menu-links" class="absolute top-full left-0 w-56 bg-white border border-gray-200 rounded-lg shadow-lg mt-2 z-50 hidden lg:hidden">
              <a href="/admin" class="block px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 font-poppins transition-colors duration-200">Dashboard</a>
              <a href="/admin/testimonios" class="block px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 font-poppins transition-colors duration-200">Testimonios</a>
              <a href="/admin/citas" class="block px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 font-poppins transition-colors duration-200">Citas</a>
              <a href="/admin/usuarios" class="block px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 font-poppins transition-colors duration-200">Usuarios</a>
              <a href="/admin/configuracion" class="block px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 font-poppins transition-colors duration-200">Configuración</a>
            </div>
            <script type="module" is:inline>
              // Mostrar/ocultar el listado de enlaces al abrir/cerrar el menú móvil
              document.addEventListener('DOMContentLoaded', () => {
              const btn = document.getElementById('mobile-menu-btn');
              const links = document.getElementById('mobile-menu-links');
              btn?.addEventListener('click', (e) => {
                e.stopPropagation();
                links?.classList.toggle('hidden');
              });
              // Cerrar el menú de enlaces si se hace click fuera
              document.addEventListener('click', (e) => {
                if (links && !btn.contains(e.target) && !links.contains(e.target)) {
                links.classList.add('hidden');
                }
              });
              });
            </script>

            <!-- Navegación central - visible en desktop (lg+) -->
                    <!-- Navegación central - solo visible en desktop (≥1024px) -->
                      <div class="desktop-nav-bar items-center flex-1 justify-center max-w-2xl mx-auto" data-responsive-element="desktop-nav">
                        <div class="flex items-center gap-1 sm:gap-2 md:gap-3 lg:gap-4">
                        <a 
                            href="/admin" 
                            class="admin-nav-link nav-item flex-shrink-0 items-center gap-2 px-3 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="dashboard"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">📊</span>
                            <span class="nav-text hidden xl:block">Dashboard</span>
                        </a>
                        <a 
                            href="/admin/testimonios" 
                            class="admin-nav-link nav-item flex-shrink-0 items-center gap-2 px-3 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="testimonios"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">💬</span>
                            <span class="nav-text hidden xl:block">Testimonios</span>
                        </a>
                        <a 
                            href="/admin/citas" 
                            class="admin-nav-link nav-item flex-shrink-0 items-center gap-2 px-3 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="citas"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">📅</span>
                            <span class="nav-text hidden xl:block">Citas</span>
                        </a>
                        <a 
                            href="/admin/usuarios" 
                            class="admin-nav-link nav-item flex-shrink-0 items-center gap-2 px-3 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="usuarios"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">👥</span>
                            <span class="nav-text hidden xl:block">Usuarios</span>
                        </a>
                        <a 
                            href="/admin/configuracion" 
                            class="admin-nav-link nav-item flex-shrink-0 items-center gap-2 px-3 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="configuracion"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">⚙️</span>
                            <span class="nav-text hidden xl:block">Configuración</span>
                        </a>
                    </div>
                             </div>
                        </div>
            </div>

            <!-- Acciones del usuario -->
            <div class="user-actions flex items-center gap-1 sm:gap-2 flex-shrink-0">
                

                <!-- Botón de actualizar -->
                <button 
                    id="admin-refresh-btn"
                    class="action-btn flex items-center justify-center p-2 text-gray-500 hover:text-pink-600 hover:bg-pink-50 rounded-full transition-all duration-200 min-w-[40px] min-h-[40px] mr-2"
                    title="Actualizar datos"
                    aria-label="Actualizar datos"
                >
                    <span id="admin-refresh-icon" class="text-lg">🔄</span>
                </button>

                <!-- Notificaciones -->
                <div class="relative mr-2">
                    <button 
                        id="notifications-btn"
                        class="action-btn flex items-center justify-center p-2 text-gray-500 hover:text-pink-600 hover:bg-pink-50 rounded-full transition-all duration-200 min-w-[40px] min-h-[40px] relative"
                        title="Notificaciones"
                        aria-label="Ver notificaciones"
                    >
                        <span class="text-lg">🔔</span>
                        <span id="notification-badge" class="notification-badge absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold">
                            0
                        </span>
                    </button>
                </div>

                <!-- Menú del usuario -->
                <div class="user-menu-container relative">
                    <button 
                        id="user-menu-btn"
                        class="user-menu-trigger flex items-center gap-2 p-2 text-gray-700 hover:text-pink-600 hover:bg-pink-50 rounded-full transition-all duration-200 min-h-[40px] min-w-[40px]"
                        aria-label="Menú del usuario"
                    >
                        <div class="user-avatar w-8 h-8 bg-gradient-to-br from-pink-200 to-purple-200 rounded-full flex items-center justify-center shadow-sm">
                            <span class="text-base">👤</span>
                        </div>
                        <span class="user-name hidden md:block font-poppins text-sm lg:text-base font-medium" id="user-email">Admin</span>
                        <span class="dropdown-arrow text-xs hidden md:block transform transition-transform duration-200"></span>
                    </button>

                    <!-- Dropdown del usuario -->
                    <div 
                        id="user-dropdown" 
                        class="absolute right-0 mt-2 w-64 sm:w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50 hidden"
                    >
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-sm font-medium text-gray-800 font-poppins">Administrador</p>
                            <p class="text-xs text-gray-500 font-poppins truncate" id="dropdown-user-email">admin@glambook.com</p>
                        </div>
                        <a 
                            href="/cambiar-password" 
                            class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors duration-200 font-poppins touch-manipulation"
                        >
                            <span class="text-base">🔑</span>
                            Cambiar Contraseña
                        </a>
                        <a 
                            href="/" 
                            target="_blank"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors duration-200 font-poppins touch-manipulation"
                        >
                            <span class="text-base">🌐</span>
                            Ver Sitio Web
                        </a>
                        <hr class="my-2 border-gray-100">
                        <button 
                            id="admin-logout-btn"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200 font-poppins w-full text-left touch-manipulation"
                        >
                            <span class="text-base">🚪</span>
                            Cerrar Sesión
                        </button>
                    </div>
                </div>

                <!-- (El botón hamburguesa ya está en el header principal) -->
            </div>
        </div>

    <!-- Menú móvil - visible solo en móviles/tablets -->
    <div id="mobile-menu" class="mobile-menu lg:hidden hidden border-t border-gray-200 bg-white overflow-hidden transition-all duration-300 ease-in-out shadow-lg">
            <div class="mobile-menu-content py-3 sm:py-4">
                
                <!-- Información del usuario en móvil -->
                <div class="mobile-user-info px-4 py-3 border-b border-gray-100 mb-2">
                    <div class="flex items-center gap-3">
                        <div class="mobile-user-avatar w-10 h-10 bg-gradient-to-br from-pink-200 to-purple-200 rounded-full flex items-center justify-center shadow-sm">
                            <span class="text-lg">👤</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800 font-poppins" id="mobile-user-name">Administrador</p>
                            <p class="text-xs text-gray-500 font-poppins truncate" id="mobile-user-email">admin@glambook.com</p>
                        </div>
                        <div class="mobile-status-indicator">
                            <span class="inline-block w-2 h-2 bg-green-400 rounded-full"></span>
                        </div>
                    </div>
                </div>

                <!-- Navegación principal móvil -->
                <div class="mobile-nav-section">
                    <div class="px-4 py-2">
                        <p class="text-xs font-semibold text-gray-500 font-poppins uppercase tracking-wide">Navegación</p>
                    </div>
                    <a href="/admin" class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation" data-page="dashboard">
                        <span class="mobile-nav-icon text-xl flex-shrink-0">📊</span>
                        <span class="mobile-nav-text font-medium">Dashboard</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    <a href="/admin/testimonios" class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation" data-page="testimonios">
                        <span class="mobile-nav-icon text-xl flex-shrink-0">💬</span>
                        <span class="mobile-nav-text font-medium">Testimonios</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    <a href="/admin/citas" class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation" data-page="citas">
                        <span class="mobile-nav-icon text-xl flex-shrink-0">📅</span>
                        <span class="mobile-nav-text font-medium">Citas</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    <a href="/admin/usuarios" class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation" data-page="usuarios">
                        <span class="mobile-nav-icon text-xl flex-shrink-0">👥</span>
                        <span class="mobile-nav-text font-medium">Usuarios</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    <a href="/admin/configuracion" class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation" data-page="configuracion">
                        <span class="mobile-nav-icon text-xl flex-shrink-0">⚙️</span>
                        <span class="mobile-nav-text font-medium">Configuración</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                </div>

                <!-- Separador -->
                <hr class="my-3 border-gray-100">

                <!-- Acciones rápidas -->
                <div class="px-4 py-2">
                    <p class="text-xs font-medium text-gray-500 font-poppins uppercase tracking-wide mb-2">Acciones</p>
                </div>

                <button 
                    id="mobile-refresh-btn"
                    class="flex items-center gap-3 px-4 py-3 text-blue-600 hover:text-blue-700 hover:bg-blue-50 transition-colors duration-200 font-poppins touch-manipulation w-full text-left"
                >
                    <span class="text-xl" id="mobile-refresh-icon">🔄</span>
                    <span class="font-medium">Actualizar Datos</span>
                </button>

                <a 
                    href="/cambiar-password" 
                    class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-colors duration-200 font-poppins touch-manipulation"
                >
                    <span class="text-xl">🔑</span>
                    <span class="font-medium">Cambiar Contraseña</span>
                </a>
                
                <a 
                    href="/" 
                    target="_blank"
                    class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-colors duration-200 font-poppins touch-manipulation"
                >
                    <span class="text-xl">🌐</span>
                    <span class="font-medium">Ver Sitio Web</span>
                </a>
                
                <!-- Separador -->
                <hr class="my-3 border-gray-100">
                
                <button 
                    id="mobile-logout-btn"
                    class="flex items-center gap-3 px-4 py-3 text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors duration-200 font-poppins touch-manipulation w-full text-left"
                >
                    <span class="text-xl">🚪</span>
                    <span class="font-medium">Cerrar Sesión</span>
                </button>
            </div>
        </div>
    </div>
</nav>

</style>
<style>
    .get-started-btn {
        display: inline-flex;
        align-items: center;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        border-radius: 0.5rem;
        padding: 0.5rem 1.25rem;
        font-size: 1rem;
        box-shadow: 0 1px 2px rgba(0,0,0,0.04);
        transition: background 0.2s;
    }
    .get-started-btn:hover {
        background: #1d4ed8;
    }
    /* ... (todo el CSS original que ya tienes) ... */
    @media (max-width: 1023px) {
        .admin-navbar .desktop-nav-bar {
            display: none !important;
        }
        .admin-navbar [data-responsive-element="desktop-nav"] {
            display: none !important;
        }
        .admin-navbar #mobile-menu-btn {
            display: flex !important;
        }
        .admin-navbar #mobile-menu {
            display: none;
        }
        .admin-navbar #mobile-menu.open {
            display: block;
        }
    }
    @media (min-width: 1024px) {
        .admin-navbar #mobile-menu-btn,
        .admin-navbar #mobile-menu {
            display: none !important;
        }
        .admin-navbar .desktop-nav-bar {
            display: flex !important;
        }
    }
</style>
<script>
// Mostrar/ocultar menú hamburguesa en móvil
document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    if (btn && menu) {
        btn.addEventListener('click', function() {
            menu.classList.toggle('open');
        });
    }
});
</script>
</style>

<script>
    // Variables globales del navbar
    let currentUser: any = null;
    let pendingTestimoniosCount = 0;

    // Elementos del DOM
    const userMenuBtn = document.getElementById('user-menu-btn');
    const userDropdown = document.getElementById('user-dropdown');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuIcon = document.getElementById('mobile-menu-icon');
    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
    const adminRefreshBtn = document.getElementById('admin-refresh-btn');
    const mobileRefreshBtn = document.getElementById('mobile-refresh-btn');
    const adminRefreshIcon = document.getElementById('admin-refresh-icon');
    const mobileRefreshIcon = document.getElementById('mobile-refresh-icon');
    const notificationBadge = document.getElementById('notification-badge');
    const userEmail = document.getElementById('user-email');
    const dropdownUserEmail = document.getElementById('dropdown-user-email');
    const mobileUserName = document.getElementById('mobile-user-name');
    const mobileUserEmail = document.getElementById('mobile-user-email');

    // Inicializar navbar
    document.addEventListener('DOMContentLoaded', () => {
        initializeAdminNavbar();
        handleResponsiveChanges();
    });

    // Manejar cambios responsive
    function handleResponsiveChanges() {
        window.addEventListener('resize', () => {
            // Cerrar menú móvil en desktop
            if (window.innerWidth >= 1024) {
                if (typeof closeMobileMenu === 'function') closeMobileMenu();
            }
            // Cerrar dropdown en cambios de tamaño
            if (typeof closeUserDropdown === 'function') closeUserDropdown();
        });
    }

    // Función para inicializar el navbar admin
    async function initializeAdminNavbar() {
        try {
            // Obtener usuario actual
            const { AuthService } = await import('../../lib/authService');
            currentUser = await AuthService.getCurrentUser();
            
            if (currentUser) {
                updateUserInfo(currentUser);
            }

            // Configurar event listeners
            setupEventListeners();
            
            // Marcar página activa
            setActivePage();
            
            // Configurar auto-refresh
            setupAutoRefresh();
            
        } catch (error) {
            console.error('Error inicializando navbar admin:', error);
        }
    }

    // Actualizar información del usuario
    function updateUserInfo(user: any) {
        const username = user.email?.split('@')[0] || 'Admin';
        const email = user.email || 'admin@glambook.com';
        
        if (userEmail) {
            userEmail.textContent = username;
        }
        if (dropdownUserEmail) {
            dropdownUserEmail.textContent = email;
        }
        if (mobileUserName) {
            mobileUserName.textContent = 'Administrador';
        }
        if (mobileUserEmail) {
            mobileUserEmail.textContent = email;
        }
    }

    // Configurar event listeners
    function setupEventListeners() {
        // Toggle del menú de usuario
        userMenuBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleUserDropdown();
        });

        // Toggle del menú móvil
        mobileMenuBtn?.addEventListener('click', () => {
            toggleMobileMenu();
        });

        // Cerrar dropdowns al hacer click fuera
        document.addEventListener('click', (e) => {
            if (!userMenuBtn?.contains(e.target as Node) && !userDropdown?.contains(e.target as Node)) {
                closeUserDropdown();
            }
            
            // Cerrar menú móvil al hacer click fuera
            if (!mobileMenuBtn?.contains(e.target as Node) && !mobileMenu?.contains(e.target as Node)) {
                closeMobileMenu();
            }
        });

        // Logout - múltiples botones
        adminLogoutBtn?.addEventListener('click', handleAdminLogout);
        mobileLogoutBtn?.addEventListener('click', handleAdminLogout);

        // Refresh - múltiples botones
        adminRefreshBtn?.addEventListener('click', handleAdminRefresh);
        mobileRefreshBtn?.addEventListener('click', handleMobileRefresh);

        // Navegación suave para anchors (desktop y móvil)
        document.querySelectorAll('.admin-nav-link[href^="#"], .mobile-nav-link[href^="#"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
                if (target && target !== '#') {
                    const sectionId = target.substring(1);
                    
                    // Usar función global si está disponible
                    if (typeof (window as any).showTab === 'function') {
                        (window as any).showTab(sectionId + '-tab');
                    } else {
                        scrollToSection(sectionId);
                    }
                    
                    // Cerrar menú móvil después de navegar
                    closeMobileMenu();
                }
            });
        });
    }

    // Toggle dropdown de usuario
    function toggleUserDropdown() {
        if (userDropdown?.classList.contains('hidden')) {
            openUserDropdown();
        } else {
            closeUserDropdown();
        }
    }

    // Abrir dropdown de usuario
    function openUserDropdown() {
        userDropdown?.classList.remove('hidden');
        setTimeout(() => {
        if (userDropdown) userDropdown.classList.add('show');
        }, 10);
    }

    // Cerrar dropdown de usuario
    function closeUserDropdown() {
        if (userDropdown) userDropdown.classList.remove('show');
        setTimeout(() => {
            if (userDropdown) userDropdown.classList.add('hidden');
        }, 200);
    }

    // Toggle menú móvil
    function toggleMobileMenu() {
        if (mobileMenu && mobileMenu.classList.contains('hidden')) {
            openMobileMenu();
        } else {
            if (typeof closeMobileMenu === 'function') closeMobileMenu();
        }
    }

    // Abrir menú móvil
    function openMobileMenu() {
        if (mobileMenu) {
            mobileMenu.classList.remove('hidden');
            setTimeout(() => {
                if (mobileMenu) mobileMenu.classList.add('show');
            }, 10);
        }
        // Añadir clase para rotar el ícono
        if (mobileMenuBtn) mobileMenuBtn.classList.add('mobile-menu-open');
        // Cambiar ícono
        if (mobileMenuIcon) {
            mobileMenuIcon.textContent = '✕';
        }
    }

    // Cerrar menú móvil
    function closeMobileMenu() {
        if (mobileMenu) {
            mobileMenu.classList.remove('show');
            setTimeout(() => {
                if (mobileMenu) mobileMenu.classList.add('hidden');
            }, 300);
        }
        // Remover clase para rotar el ícono
        if (mobileMenuBtn) mobileMenuBtn.classList.remove('mobile-menu-open');
        // Restaurar ícono
        if (mobileMenuIcon) {
            mobileMenuIcon.textContent = '☰';
        }
    }

    // Manejar logout desde navbar
    async function handleAdminLogout() {
        try {
            const { AuthService } = await import('../../lib/authService');
            await AuthService.signOut();
            window.location.href = '/login';
        } catch (error) {
            console.error('Error al cerrar sesión:', error);
            window.location.href = '/login';
        }
    }

    // Manejar refresh desde navbar
    async function handleAdminRefresh() {
        if (adminRefreshIcon) {
            adminRefreshIcon.textContent = '⏳';
            // Llamar a la función global de refresh si existe
            if (typeof (window as any).cargarTestimoniosPendientes === 'function') {
                await (window as any).cargarTestimoniosPendientes();
            }
            setTimeout(() => {
                if (adminRefreshIcon) {
                    adminRefreshIcon.textContent = '🔄';
                }
            }, 1000);
        }
    }

    // Manejar refresh desde móvil
    async function handleMobileRefresh() {
        if (mobileRefreshIcon) {
            mobileRefreshIcon.textContent = '⏳';
            // Llamar a la función global de refresh si existe
            if (typeof (window as any).cargarTestimoniosPendientes === 'function') {
                await (window as any).cargarTestimoniosPendientes();
            }
            setTimeout(() => {
                if (mobileRefreshIcon) {
                    mobileRefreshIcon.textContent = '🔄';
                }
            }, 1000);
        }
        // Cerrar menú móvil después del refresh
        if (typeof closeMobileMenu === 'function') closeMobileMenu();
    }

    // Marcar página activa basada en la URL
    function setActivePage() {
        const currentPath = window.location.pathname;
        const currentHash = window.location.hash;
        
        // Limpiar clases activas
        document.querySelectorAll('.admin-nav-link, .mobile-nav-link').forEach(link => {
            if (link) link.classList.remove('active');
        });
        // Marcar enlaces activos
        document.querySelectorAll('.admin-nav-link, .mobile-nav-link').forEach(link => {
            const href = link.getAttribute('href');
            if (href === currentPath || (href?.startsWith('#') && href === currentHash)) {
                if (link) link.classList.add('active');
            }
        });

        // Si estamos en /admin sin hash, marcar dashboard como activo
        if (currentPath === '/admin' && !currentHash) {
            document.querySelectorAll('.admin-nav-link[data-page="dashboard"], .mobile-nav-link[data-page="dashboard"]').forEach(link => {
                link.classList.add('active');
            });
        }
    }

    // Scroll suave a sección
    function scrollToSection(sectionId: string) {
        const element = document.getElementById(sectionId);
        if (element) {
            element.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            // Actualizar URL sin recargar página
            history.pushState(null, '', `#${sectionId}`);
            
            // Actualizar navegación activa
            setTimeout(setActivePage, 100);
        }
    }

    // Configurar auto-refresh
    function setupAutoRefresh() {
        // Actualizar badge de notificaciones cada 30 segundos
        setInterval(async () => {
            try {
                const response = await fetch('/api/testimonios?action=pendientes');
                if (response.ok) {
                    const data = await response.json();
                    const count = Array.isArray(data) ? data.length : 0;
                    updateNotificationBadge(count);
                }
            } catch (error) {
                console.error('Error actualizando notificaciones:', error);
            }
        }, 30000);
    }

    // Actualizar badge de notificaciones
    function updateNotificationBadge(count: number) {
        if (notificationBadge) {
            if (count > 0) {
                notificationBadge.textContent = count.toString();
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }
    }

    // Hacer funciones disponibles globalmente para uso externo
    (window as any).adminNavbar = {
        updateNotificationBadge,
        setActivePage,
        updateUserInfo
    };

    // Escuchar cambios de hash para actualizar navegación
    window.addEventListener('hashchange', setActivePage);
    
</script>