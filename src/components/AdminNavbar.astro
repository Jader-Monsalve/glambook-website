---
// AdminNavbar.astro - Navbar específico para el panel de administración
---

<nav class="admin-navbar bg-white/90 backdrop-blur-md border-b border-gray-200 shadow-sm sticky top-0 z-50">
    <div class="navbar-container max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 xl:px-8">
        <div class="flex justify-between items-center h-12 sm:h-14 lg:h-16">
            
            <!-- Logo y título del admin -->
            <div class="flex items-center navbar-logo flex-shrink-0">
                <div class="flex items-center gap-1 sm:gap-2 lg:gap-3">
                    <div class="logo-icon w-6 h-6 sm:w-8 sm:h-8 lg:w-10 lg:h-10 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md">
                        <span class="text-white text-xs sm:text-sm lg:text-base font-bold">G</span>
                    </div>
                    <div class="logo-text hidden sm:block">
                        <h1 class="text-sm sm:text-base lg:text-lg xl:text-xl font-bold text-gray-800 font-poppins leading-tight">GlamBook</h1>
                        <p class="admin-subtitle text-xs text-gray-500 font-poppins hidden lg:block leading-none">Panel de Administración</p>
                    </div>
                </div>
            </div>

            <!-- Navegación central - Solo desktop (1024px+) -->
            <div class="hidden lg:flex items-center flex-1 justify-center max-w-2xl mx-auto" style="display: none !important;"
                 data-responsive-element="desktop-nav">
                <div class="bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl p-1 shadow-lg">
                    <div class="flex items-center space-x-0">
                        <a 
                            href="/admin" 
                            class="nav-item flex items-center gap-2 px-3 lg:px-4 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="dashboard"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">📊</span>
                            <span class="nav-text hidden xl:block">Dashboard</span>
                        </a>
                        
                        <a 
                            href="#testimonios" 
                            class="nav-item flex items-center gap-2 px-3 lg:px-4 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="testimonios"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">💬</span>
                            <span class="nav-text hidden xl:block">Testimonios</span>
                        </a>
                        
                        <a 
                            href="#citas" 
                            class="nav-item flex items-center gap-2 px-3 lg:px-4 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="citas"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">📅</span>
                            <span class="nav-text hidden xl:block">Citas</span>
                        </a>
                    
                        <a 
                            href="#usuarios" 
                            class="nav-item flex items-center gap-2 px-3 lg:px-4 py-2.5 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm font-medium relative group"
                            data-page="usuarios"
                        >
                            <span class="nav-icon text-base group-hover:scale-110 transition-transform">👥</span>
                            <span class="nav-text hidden xl:block">Usuarios</span>
                        </a>
                    
                    <a 
                        href="#disponibilidad" 
                        class="admin-nav-link nav-item flex items-center gap-2 px-2 lg:px-3 py-2 rounded-lg text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-all duration-200 font-poppins text-sm lg:text-sm xl:text-base relative"
                        data-page="disponibilidad"
                    >
                        <span class="nav-icon text-base lg:text-lg">�️</span>
                        <span class="nav-text">Disponibilidad</span>
                    </a>
                </div>
            </div>

            <!-- Acciones del usuario -->
            <div class="user-actions flex items-center gap-1 sm:gap-2 flex-shrink-0">
                
                <!-- Botón de actualizar -->
                <button 
                    id="admin-refresh-btn"
                    class="action-btn p-1.5 sm:p-2 text-gray-500 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 touch-manipulation min-w-[36px] min-h-[36px] sm:min-w-[40px] sm:min-h-[40px] flex items-center justify-center"
                    title="Actualizar datos"
                    aria-label="Actualizar datos"
                >
                    <span id="admin-refresh-icon" class="text-sm sm:text-base">🔄</span>
                </button>

                <!-- Notificaciones -->
                <div class="relative">
                    <button 
                        id="notifications-btn"
                        class="action-btn p-2 text-gray-500 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 relative touch-manipulation min-w-[40px] min-h-[40px] flex items-center justify-center"
                        title="Notificaciones"
                        aria-label="Ver notificaciones"
                    >
                        <span class="text-base sm:text-lg">🔔</span>
                        <span id="notification-badge" class="notification-badge absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full items-center justify-center hidden font-bold">
                            0
                        </span>
                    </button>
                </div>

                <!-- Menú del usuario -->
                <div class="user-menu-container relative">
                    <button 
                        id="user-menu-btn"
                        class="user-menu-trigger flex items-center gap-1 sm:gap-2 p-1 sm:p-2 text-gray-700 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 touch-manipulation min-h-[40px]"
                        aria-label="Menú del usuario"
                    >
                        <div class="user-avatar w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-pink-200 to-purple-200 rounded-full flex items-center justify-center shadow-sm">
                            <span class="text-sm sm:text-base">👤</span>
                        </div>
                        <span class="user-name hidden md:block font-poppins text-sm lg:text-base font-medium" id="user-email">Admin</span>
                        <span class="dropdown-arrow text-xs hidden md:block transform transition-transform duration-200">⌄</span>
                    </button>

                    <!-- Dropdown del usuario -->
                    <div 
                        id="user-dropdown" 
                        class="absolute right-0 mt-2 w-64 sm:w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50 hidden"
                    >
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-sm font-medium text-gray-800 font-poppins">Administrador</p>
                            <p class="text-xs text-gray-500 font-poppins truncate" id="dropdown-user-email">admin@glambook.com</p>
                        </div>
                        
                        <a 
                            href="/cambiar-password" 
                            class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors duration-200 font-poppins touch-manipulation"
                        >
                            <span class="text-base">🔑</span>
                            Cambiar Contraseña
                        </a>
                        
                        <a 
                            href="/" 
                            target="_blank"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-colors duration-200 font-poppins touch-manipulation"
                        >
                            <span class="text-base">🌐</span>
                            Ver Sitio Web
                        </a>
                        
                        <hr class="my-2 border-gray-100">
                        
                        <button 
                            id="admin-logout-btn"
                            class="flex items-center gap-3 px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200 font-poppins w-full text-left touch-manipulation"
                        >
                            <span class="text-base">🚪</span>
                            Cerrar Sesión
                        </button>
                    </div>
                </div>

                <!-- Botón de menú móvil - VISIBLE EN MÓVIL Y TABLET -->
                <button 
                    id="mobile-menu-btn"
                    class="lg:hidden p-2 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 touch-manipulation ml-2 min-w-[44px] min-h-[44px] flex items-center justify-center bg-white border border-gray-200 shadow-sm"
                    aria-label="Abrir menú de navegación"
                    aria-expanded="false"
                    style="display: flex !important;"
                >
                    <span id="mobile-menu-icon" class="text-xl block transition-transform duration-300 font-bold">☰</span>
                </button>
            </div>
        </div>

        <!-- Menú móvil -->
        <div id="mobile-menu" class="mobile-menu lg:hidden hidden border-t border-gray-200 bg-white overflow-hidden transition-all duration-300 ease-in-out shadow-lg">
            <div class="mobile-menu-content py-3 sm:py-4">
                
                <!-- Información del usuario en móvil -->
                <div class="mobile-user-info px-4 py-3 border-b border-gray-100 mb-2">
                    <div class="flex items-center gap-3">
                        <div class="mobile-user-avatar w-10 h-10 bg-gradient-to-br from-pink-200 to-purple-200 rounded-full flex items-center justify-center shadow-sm">
                            <span class="text-lg">👤</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-800 font-poppins" id="mobile-user-name">Administrador</p>
                            <p class="text-xs text-gray-500 font-poppins truncate" id="mobile-user-email">admin@glambook.com</p>
                        </div>
                        <div class="mobile-status-indicator">
                            <span class="inline-block w-2 h-2 bg-green-400 rounded-full"></span>
                        </div>
                    </div>
                </div>

                <!-- Navegación principal -->
                <div class="mobile-nav-section">
                    <div class="px-4 py-2">
                        <p class="text-xs font-semibold text-gray-500 font-poppins uppercase tracking-wide">Navegación</p>
                    </div>
                    
                    <a 
                        href="/admin" 
                        class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation"
                        data-page="dashboard"
                    >
                        <span class="mobile-nav-icon text-xl flex-shrink-0">📊</span>
                        <span class="mobile-nav-text font-medium">Dashboard</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    
                    <a 
                        href="#testimonios" 
                        class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation"
                        data-page="testimonios"
                    >
                        <span class="mobile-nav-icon text-xl flex-shrink-0">💬</span>
                        <span class="mobile-nav-text font-medium">Testimonios</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    
                    <a 
                        href="#citas" 
                        class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation"
                        data-page="citas"
                    >
                        <span class="mobile-nav-icon text-xl flex-shrink-0">📅</span>
                        <span class="mobile-nav-text font-medium">Citas</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    
                    <a 
                        href="#usuarios" 
                        class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation"
                        data-page="usuarios"
                    >
                        <span class="mobile-nav-icon text-xl flex-shrink-0">👥</span>
                        <span class="mobile-nav-text font-medium">Usuarios</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                    
                    <a 
                        href="#disponibilidad" 
                        class="mobile-nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 active:bg-pink-100 transition-all duration-200 font-poppins touch-manipulation"
                        data-page="disponibilidad"
                    >
                        <span class="mobile-nav-icon text-xl flex-shrink-0">�️</span>
                        <span class="mobile-nav-text font-medium">Disponibilidad</span>
                        <span class="mobile-nav-arrow ml-auto text-gray-400 transform transition-transform">›</span>
                    </a>
                </div>

                <!-- Separador -->
                <hr class="my-3 border-gray-100">

                <!-- Acciones rápidas -->
                <div class="px-4 py-2">
                    <p class="text-xs font-medium text-gray-500 font-poppins uppercase tracking-wide mb-2">Acciones</p>
                </div>

                <button 
                    id="mobile-refresh-btn"
                    class="flex items-center gap-3 px-4 py-3 text-blue-600 hover:text-blue-700 hover:bg-blue-50 transition-colors duration-200 font-poppins touch-manipulation w-full text-left"
                >
                    <span class="text-xl" id="mobile-refresh-icon">🔄</span>
                    <span class="font-medium">Actualizar Datos</span>
                </button>

                <a 
                    href="/cambiar-password" 
                    class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-colors duration-200 font-poppins touch-manipulation"
                >
                    <span class="text-xl">🔑</span>
                    <span class="font-medium">Cambiar Contraseña</span>
                </a>
                
                <a 
                    href="/" 
                    target="_blank"
                    class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:text-pink-600 hover:bg-pink-50 transition-colors duration-200 font-poppins touch-manipulation"
                >
                    <span class="text-xl">🌐</span>
                    <span class="font-medium">Ver Sitio Web</span>
                </a>
                
                <!-- Separador -->
                <hr class="my-3 border-gray-100">
                
                <button 
                    id="mobile-logout-btn"
                    class="flex items-center gap-3 px-4 py-3 text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors duration-200 font-poppins touch-manipulation w-full text-left"
                >
                    <span class="text-xl">🚪</span>
                    <span class="font-medium">Cerrar Sesión</span>
                </button>
            </div>
        </div>
    </div>
</nav>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    .font-poppins {
        font-family: 'Poppins', sans-serif;
    }

    /* ====================================
         SISTEMA DE BREAKPOINTS OPTIMIZADO:
         - 2xl: 1536px+ (Desktop extra grande)
         - xl:  1280px+ (Desktop grande)
         - lg:  1024px+ (Desktop/Laptop)  
         - md:  768px+  (Tablet)
         - sm:  640px+  (Tablet pequeña)
         - xs:  480px+  (Mobile grande)
         - default: <480px (Mobile pequeño)
         ==================================== */

    /* ===== VARIABLES CSS PARA CONSISTENCIA ===== */
    :root {
        --navbar-height: 3.5rem;
        --navbar-height-sm: 4rem;
        --nav-padding-x: 0.75rem;
        --nav-padding-x-sm: 1rem;
        --nav-padding-x-lg: 1.5rem;
        --nav-padding-x-xl: 2rem;
        --pink-primary: rgb(219 39 119);
        --pink-light: rgb(252 231 243);
        --purple-primary: rgb(147 51 234);
        --shadow-color: rgba(0, 0, 0, 0.1);
        --transition-fast: 0.15s ease;
        --transition-normal: 0.2s ease;
        --transition-slow: 0.3s ease;
        --border-radius: 0.5rem;
        --touch-target: 44px;
    }

    /* ===== BASE STYLES ===== */
    .admin-navbar {
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    .navbar-container {
        padding-left: var(--nav-padding-x);
        padding-right: var(--nav-padding-x);
    }

    .navbar-height {
        height: var(--navbar-height);
    }

    /* ===== LOGO Y BRANDING ===== */
    .navbar-logo {
        flex-shrink: 0;
    }

    .logo-icon {
        transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }

    .logo-icon:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px var(--shadow-color);
    }

    .logo-text {
        display: none;
    }

    .admin-subtitle {
        display: none;
    }

    /* ===== NAVEGACIÓN DESKTOP ===== */
    .desktop-nav {
        display: none;
    }

    .desktop-nav-container {
        background: rgba(255, 255, 255, 0.8);
        border-radius: var(--border-radius);
        padding: 0.25rem;
        backdrop-filter: blur(4px);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .nav-item {
        position: relative;
        border-radius: calc(var(--border-radius) - 0.125rem);
        font-weight: 500;
        white-space: nowrap;
    }

    .nav-item::before {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 50%;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--pink-primary), var(--purple-primary));
        transition: all var(--transition-slow);
        transform: translateX(-50%);
        border-radius: 1px;
    }

    .nav-item:hover::before,
    .nav-item.active::before {
        width: 80%;
    }

    .nav-item:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px var(--shadow-color);
    }

    .nav-item.active {
        background-color: var(--pink-light);
        color: var(--pink-primary);
        font-weight: 600;
    }

    .nav-icon {
        transition: transform var(--transition-fast);
    }

    .nav-item:hover .nav-icon {
        transform: scale(1.1);
    }

    /* ===== ACCIONES DE USUARIO ===== */
    .user-actions {
        flex-shrink: 0;
        gap: 0.25rem;
    }

    .action-btn {
        border-radius: var(--border-radius);
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
    }

    .action-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle, var(--pink-primary) 0%, transparent 70%);
        opacity: 0;
        transition: opacity var(--transition-fast);
        pointer-events: none;
    }

    .action-btn:hover::before {
        opacity: 0.1;
    }

    .action-btn:active {
        transform: scale(0.95);
    }

    .notification-badge:not(.hidden) {
        display: flex;
        animation: pulse 2s infinite;
    }

    .user-menu-trigger {
        border-radius: var(--border-radius);
        transition: all var(--transition-normal);
    }

    .user-menu-trigger:hover .dropdown-arrow {
        transform: rotate(180deg);
    }

    .user-avatar {
        transition: transform var(--transition-normal);
    }

    .user-menu-trigger:hover .user-avatar {
        transform: scale(1.05);
    }

    .user-name {
        display: none;
    }

    /* ===== MENÚ MÓVIL ===== */
    .mobile-menu-trigger {
        border-radius: var(--border-radius);
        transition: all var(--transition-normal);
        position: relative;
    }

    .mobile-menu {
        max-height: 0;
        opacity: 0;
        transition: all var(--transition-slow);
        background: linear-gradient(to bottom, #ffffff, #fefefe);
    }

    .mobile-menu.show {
        max-height: 100vh;
        opacity: 1;
    }

    .mobile-nav-section {
        padding-bottom: 0.5rem;
    }

    .mobile-nav-link {
        border-radius: calc(var(--border-radius) - 0.125rem);
        margin: 0 0.5rem;
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
    }

    .mobile-nav-link::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0;
        background: linear-gradient(to bottom, var(--pink-primary), var(--purple-primary));
        transition: width var(--transition-normal);
    }

    .mobile-nav-link.active::before {
        width: 4px;
    }

    .mobile-nav-link:active {
        transform: scale(0.98);
    }

    .mobile-nav-link:hover .mobile-nav-arrow,
    .mobile-nav-link.active .mobile-nav-arrow {
        transform: translateX(4px);
        color: var(--pink-primary);
    }

    .mobile-nav-arrow {
        transition: all var(--transition-normal);
    }

    .mobile-user-info {
        background: linear-gradient(135deg, rgba(219, 39, 119, 0.05), rgba(147, 51, 234, 0.05));
        border-radius: var(--border-radius);
        margin: 0 0.5rem;
    }

    .mobile-status-indicator {
        animation: pulse-dot 2s infinite;
    }

    /* ===== DROPDOWN STYLES ===== */
    #user-dropdown {
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px) scale(0.95);
        transition: all var(--transition-normal);
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    #user-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
    }

    /* ===== ANIMATIONS ===== */
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    @keyframes pulse-dot {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* ===== MOBILE PEQUEÑO (default: <480px) ===== */
    @media (max-width: 479px) {
        .navbar-container {
            padding-left: 0.5rem !important;
            padding-right: 0.5rem !important;
        }
        
        .logo-text {
            display: none !important;
        }
        
        .user-actions {
            gap: 0.125rem !important;
        }
        
        .desktop-nav {
            display: none !important;
        }
        
        .mobile-menu-trigger {
            display: flex !important;
        }
        
        #user-dropdown {
            position: fixed !important;
            right: 0.5rem !important;
            left: 0.5rem !important;
            width: auto !important;
            max-width: none !important;
        }
    }

    /* ===== MOBILE GRANDE (xs: 480px+) ===== */
    @media (min-width: 480px) and (max-width: 639px) {
        .logo-text {
            display: block !important;
        }
        
        .desktop-nav {
            display: none !important;
        }
        
        .mobile-menu-trigger {
            display: flex !important;
        }
        
        .navbar-container {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }
        
        .user-actions {
            gap: 0.375rem !important;
        }
    }

    /* ===== TABLET PEQUEÑA (sm: 640px+) ===== */
    @media (min-width: 640px) and (max-width: 1023px) {
        .desktop-nav {
            display: none !important;
        }
        
        .mobile-menu-trigger {
            display: flex !important;
        }
        
        .navbar-container {
            padding-left: 1.5rem !important;
            padding-right: 1.5rem !important;
        }
        
        .user-actions {
            gap: 0.5rem !important;
        }
        
        .logo-text {
            display: block !important;
        }
        
        .admin-subtitle {
            display: none !important;
        }
    }

    /* ===== TABLET (md: 768px+) ===== */
    @media (min-width: 768px) {
        .user-name {
            display: block;
        }
        
        #user-dropdown {
            position: absolute;
            right: 0;
            width: 14rem;
        }
        
        .dropdown-arrow {
            display: block;
        }
    }

    /* ===== DESKTOP/LAPTOP (lg: 1024px+) ===== */
    @media (min-width: 1024px) {
        .desktop-nav {
            display: flex !important;
        }
        
        .mobile-menu-trigger {
            display: none !important;
        }
        
        .mobile-menu {
            display: none !important;
        }
        
        .admin-subtitle {
            display: block !important;
        }
        
        .logo-text {
            display: block !important;
        }
        
        .nav-text {
            display: none !important;
        }
    }

    /* ===== DESKTOP GRANDE (xl: 1280px+) ===== */
    @media (min-width: 1280px) {
        .desktop-nav {
            display: flex !important;
        }
        
        .mobile-menu-trigger {
            display: none !important;
        }
        
        .nav-text {
            display: block !important;
        }
        
        .navbar-container {
            padding-left: 2rem !important;
            padding-right: 2rem !important;
        }
        
        .nav-item {
            padding: 0.75rem 1rem !important;
        }
        
        .admin-subtitle {
            display: block !important;
        }
    }

    /* ===== DESKTOP MUY GRANDE (2xl: 1536px+) ===== */
    @media (min-width: 1536px) {
        .nav-item {
            padding: 0.875rem 1.25rem;
            font-size: 1rem;
        }
        
        .desktop-nav-container {
            padding: 0.5rem;
        }
    }

    /* ===== OPTIMIZACIONES TÁCTILES ===== */
    .touch-manipulation {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
    }

    @media (hover: none) and (pointer: coarse) {
        .action-btn:active,
        .nav-item:active,
        .mobile-nav-link:active {
            transform: scale(0.96);
            transition: transform 0.1s ease;
        }
        
        .nav-item::before {
            display: none;
        }
    }

    /* ===== ACCESIBILIDAD ===== */
    .action-btn:focus-visible,
    .nav-item:focus-visible,
    .mobile-nav-link:focus-visible,
    .user-menu-trigger:focus-visible,
    .mobile-menu-trigger:focus-visible {
        outline: 2px solid var(--pink-primary);
        outline-offset: 2px;
        border-radius: var(--border-radius);
    }

    @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* ===== MODO OSCURO (si se implementa en el futuro) ===== */
    @media (prefers-color-scheme: dark) {
        .admin-navbar {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .desktop-nav-container {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .mobile-menu {
            background: linear-gradient(to bottom, #1f1f1f, #2a2a2a);
        }
    }

    /* ===== ESTADOS DE CARGA Y ERROR ===== */
    .loading {
        pointer-events: none;
        opacity: 0.7;
    }

    .loading .action-btn {
        animation: loading-pulse 1.5s ease-in-out infinite;
    }

    @keyframes loading-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
</style>

<script>
    // Variables globales del navbar
    let currentUser: any = null;
    let pendingTestimoniosCount = 0;

    // Elementos del DOM
    const userMenuBtn = document.getElementById('user-menu-btn');
    const userDropdown = document.getElementById('user-dropdown');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuIcon = document.getElementById('mobile-menu-icon');
    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
    const adminRefreshBtn = document.getElementById('admin-refresh-btn');
    const mobileRefreshBtn = document.getElementById('mobile-refresh-btn');
    const adminRefreshIcon = document.getElementById('admin-refresh-icon');
    const mobileRefreshIcon = document.getElementById('mobile-refresh-icon');
    const notificationBadge = document.getElementById('notification-badge');
    const userEmail = document.getElementById('user-email');
    const dropdownUserEmail = document.getElementById('dropdown-user-email');
    const mobileUserName = document.getElementById('mobile-user-name');
    const mobileUserEmail = document.getElementById('mobile-user-email');

    // Inicializar navbar
    document.addEventListener('DOMContentLoaded', () => {
        initializeAdminNavbar();
        handleResponsiveChanges();
    });

    // Manejar cambios responsive
    function handleResponsiveChanges() {
        window.addEventListener('resize', () => {
            // Cerrar menú móvil en desktop
            if (window.innerWidth >= 1024) {
                closeMobileMenu();
            }
            
            // Cerrar dropdown en cambios de tamaño
            closeUserDropdown();
        });
    }

    // Función para inicializar el navbar admin
    async function initializeAdminNavbar() {
        try {
            // Obtener usuario actual
            const { AuthService } = await import('../lib/authService');
            currentUser = await AuthService.getCurrentUser();
            
            if (currentUser) {
                updateUserInfo(currentUser);
            }

            // Configurar event listeners
            setupEventListeners();
            
            // Marcar página activa
            setActivePage();
            
            // Configurar auto-refresh
            setupAutoRefresh();
            
        } catch (error) {
            console.error('Error inicializando navbar admin:', error);
        }
    }

    // Actualizar información del usuario
    function updateUserInfo(user: any) {
        const username = user.email?.split('@')[0] || 'Admin';
        const email = user.email || 'admin@glambook.com';
        
        if (userEmail) {
            userEmail.textContent = username;
        }
        
        if (dropdownUserEmail) {
            dropdownUserEmail.textContent = email;
        }

        if (mobileUserName) {
            mobileUserName.textContent = 'Administrador';
        }

        if (mobileUserEmail) {
            mobileUserEmail.textContent = email;
        }
    }

    // Configurar event listeners
    function setupEventListeners() {
        // Toggle del menú de usuario
        userMenuBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleUserDropdown();
        });

        // Toggle del menú móvil
        mobileMenuBtn?.addEventListener('click', () => {
            toggleMobileMenu();
        });

        // Cerrar dropdowns al hacer click fuera
        document.addEventListener('click', (e) => {
            if (!userMenuBtn?.contains(e.target as Node) && !userDropdown?.contains(e.target as Node)) {
                closeUserDropdown();
            }
            
            // Cerrar menú móvil al hacer click fuera
            if (!mobileMenuBtn?.contains(e.target as Node) && !mobileMenu?.contains(e.target as Node)) {
                closeMobileMenu();
            }
        });

        // Logout - múltiples botones
        adminLogoutBtn?.addEventListener('click', handleAdminLogout);
        mobileLogoutBtn?.addEventListener('click', handleAdminLogout);

        // Refresh - múltiples botones
        adminRefreshBtn?.addEventListener('click', handleAdminRefresh);
        mobileRefreshBtn?.addEventListener('click', handleMobileRefresh);

        // Navegación suave para anchors (desktop y móvil)
        document.querySelectorAll('.admin-nav-link[href^="#"], .mobile-nav-link[href^="#"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
                if (target && target !== '#') {
                    const sectionId = target.substring(1);
                    
                    // Usar función global si está disponible
                    if (typeof (window as any).showTab === 'function') {
                        (window as any).showTab(sectionId + '-tab');
                    } else {
                        scrollToSection(sectionId);
                    }
                    
                    // Cerrar menú móvil después de navegar
                    closeMobileMenu();
                }
            });
        });
    }

    // Toggle dropdown de usuario
    function toggleUserDropdown() {
        if (userDropdown?.classList.contains('hidden')) {
            openUserDropdown();
        } else {
            closeUserDropdown();
        }
    }

    // Abrir dropdown de usuario
    function openUserDropdown() {
        userDropdown?.classList.remove('hidden');
        setTimeout(() => {
            userDropdown?.classList.add('show');
        }, 10);
    }

    // Cerrar dropdown de usuario
    function closeUserDropdown() {
        userDropdown?.classList.remove('show');
        setTimeout(() => {
            userDropdown?.classList.add('hidden');
        }, 200);
    }

    // Toggle menú móvil
    function toggleMobileMenu() {
        if (mobileMenu?.classList.contains('hidden')) {
            openMobileMenu();
        } else {
            closeMobileMenu();
        }
    }

    // Abrir menú móvil
    function openMobileMenu() {
        mobileMenu?.classList.remove('hidden');
        setTimeout(() => {
            mobileMenu?.classList.add('show');
        }, 10);
        
        // Añadir clase para rotar el ícono
        mobileMenuBtn?.classList.add('mobile-menu-open');
        
        // Cambiar ícono
        if (mobileMenuIcon) {
            mobileMenuIcon.textContent = '✕';
        }
    }

    // Cerrar menú móvil
    function closeMobileMenu() {
        mobileMenu?.classList.remove('show');
        setTimeout(() => {
            mobileMenu?.classList.add('hidden');
        }, 300);
        
        // Remover clase para rotar el ícono
        mobileMenuBtn?.classList.remove('mobile-menu-open');
        
        // Restaurar ícono
        if (mobileMenuIcon) {
            mobileMenuIcon.textContent = '☰';
        }
    }

    // Manejar logout desde navbar
    async function handleAdminLogout() {
        try {
            const { AuthService } = await import('../lib/authService');
            await AuthService.signOut();
            window.location.href = '/login';
        } catch (error) {
            console.error('Error al cerrar sesión:', error);
            window.location.href = '/login';
        }
    }

    // Manejar refresh desde navbar
    async function handleAdminRefresh() {
        if (adminRefreshIcon) {
            adminRefreshIcon.textContent = '⏳';
            
            // Llamar a la función global de refresh si existe
            if (typeof (window as any).cargarTestimoniosPendientes === 'function') {
                await (window as any).cargarTestimoniosPendientes();
            }
            
            setTimeout(() => {
                if (adminRefreshIcon) {
                    adminRefreshIcon.textContent = '🔄';
                }
            }, 1000);
        }
    }

    // Manejar refresh desde móvil
    async function handleMobileRefresh() {
        if (mobileRefreshIcon) {
            mobileRefreshIcon.textContent = '⏳';
            
            // Llamar a la función global de refresh si existe
            if (typeof (window as any).cargarTestimoniosPendientes === 'function') {
                await (window as any).cargarTestimoniosPendientes();
            }
            
            setTimeout(() => {
                if (mobileRefreshIcon) {
                    mobileRefreshIcon.textContent = '🔄';
                }
            }, 1000);
        }
        
        // Cerrar menú móvil después del refresh
        closeMobileMenu();
    }

    // Marcar página activa basada en la URL
    function setActivePage() {
        const currentPath = window.location.pathname;
        const currentHash = window.location.hash;
        
        // Limpiar clases activas
        document.querySelectorAll('.admin-nav-link, .mobile-nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Marcar enlaces activos
        document.querySelectorAll('.admin-nav-link, .mobile-nav-link').forEach(link => {
            const href = link.getAttribute('href');
            if (href === currentPath || (href?.startsWith('#') && href === currentHash)) {
                link.classList.add('active');
            }
        });

        // Si estamos en /admin sin hash, marcar dashboard como activo
        if (currentPath === '/admin' && !currentHash) {
            document.querySelectorAll('.admin-nav-link[data-page="dashboard"], .mobile-nav-link[data-page="dashboard"]').forEach(link => {
                link.classList.add('active');
            });
        }
    }

    // Scroll suave a sección
    function scrollToSection(sectionId: string) {
        const element = document.getElementById(sectionId);
        if (element) {
            element.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            // Actualizar URL sin recargar página
            history.pushState(null, '', `#${sectionId}`);
            
            // Actualizar navegación activa
            setTimeout(setActivePage, 100);
        }
    }

    // Configurar auto-refresh
    function setupAutoRefresh() {
        // Actualizar badge de notificaciones cada 30 segundos
        setInterval(async () => {
            try {
                const response = await fetch('/api/testimonios?action=pendientes');
                if (response.ok) {
                    const data = await response.json();
                    const count = Array.isArray(data) ? data.length : 0;
                    updateNotificationBadge(count);
                }
            } catch (error) {
                console.error('Error actualizando notificaciones:', error);
            }
        }, 30000);
    }

    // Actualizar badge de notificaciones
    function updateNotificationBadge(count: number) {
        if (notificationBadge) {
            if (count > 0) {
                notificationBadge.textContent = count.toString();
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }
    }

    // Hacer funciones disponibles globalmente para uso externo
    (window as any).adminNavbar = {
        updateNotificationBadge,
        setActivePage,
        updateUserInfo
    };

    // Escuchar cambios de hash para actualizar navegación
    window.addEventListener('hashchange', setActivePage);
    
    // Función para manejar responsive manualmente
    function handleResponsive() {
        const screenWidth = window.innerWidth;
        const desktopNav = document.querySelector('[data-responsive-element="desktop-nav"]');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        
        if (screenWidth >= 1024) {
            // Desktop: mostrar navegación desktop, ocultar botón móvil
            if (desktopNav) desktopNav.style.display = 'flex';
            if (mobileMenuBtn) mobileMenuBtn.style.display = 'none';
        } else {
            // Móvil/Tablet: ocultar navegación desktop, mostrar botón móvil
            if (desktopNav) desktopNav.style.display = 'none';
            if (mobileMenuBtn) mobileMenuBtn.style.display = 'flex';
        }
        
        // Console log removido para producción
    }
    
    // Llamar al cargar la página
    handleResponsive();
    
    // Escuchar cambios de tamaño de ventana
    window.addEventListener('resize', handleResponsive);
    
    // Forzar manejo responsive después de un pequeño delay
    setTimeout(handleResponsive, 100);
</script>